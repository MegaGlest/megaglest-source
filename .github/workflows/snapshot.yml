name: Make Snapshot
concurrency:
  group: build-${{ github.ref }}
  cancel-in-progress: true
on:
  push:
    branches: [ develop ]

# The artifact only runs on the same distro that it was built on.
# TODO: make AppImage instead
jobs:
  make-snapshot:
    strategy:
      fail-fast: false
    runs-on: ubuntu-22.04
    steps:
    - uses: actions/checkout@v3
    - name: Get dependencies
      run: |
        sudo apt-get update && sudo apt-get upgrade
        sudo mk/linux/setupBuildDeps.sh
        sudo apt install libfuse2
    - name: Build
      run:  |
        mk/linux/build-appimage.sh
    - name: Create MegaGlest Snapshot
      uses: actions/upload-artifact@v2
      with:
        name: megaglest-x64-ubuntu
        path: |
          mk/linux/MegaGlest*.AppImage

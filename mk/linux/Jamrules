if ! $(top_builddir)
{
    top_builddir = $(TOP) ;
}
top_srcdir = $(TOP) ;

MGFLAGS = -fno-strict-aliasing -frounding-math  -fsignaling-nans -mfpmath=sse -msse -msse2 

JAMCONFIG ?= $(top_builddir)/Jamconfig ;
include $(JAMCONFIG) ;
if ! $(JAMCONFIG_READ)
{
  EXIT "Couldn't find config. Please run 'configure' first." ;
}

if $(USE_STLPORT_DEBUG)
{
  CPPFLAGS += -I/usr/include/stlport ;
  CPPFLAGS += -D_STLP_DEBUG=1 -D_STLP_DEBUG_UNINITIALIZED=1 ;
  CPPFLAGS += -D_STLP_SHRED_BYTE=0xA3 ;
  LIBS += -lstlport_gcc_debug ;
}

# if using streflop then add some special compiler defines
if $(USE_STREFLOP)
{
#   COMPILER_CFLAGS_optimize += -mfpmath=sse -msse -fsingle-precision-constant -pipe -fno-strict-aliasing $(MGFLAGS) -mieee-fp -mno-tls-direct-seg-refs ;
#   COMPILER_CXXFLAGS_optimize += -mfpmath=sse -msse -fsingle-precision-constant -frounding-math -pipe -fno-strict-aliasing $(MGFLAGS) -mieee-fp -mno-tls-direct-seg-refs ;
   CPPFLAGS                 += $(MGFLAGS) ;
   COMPILER_CFLAGS          += $(MGFLAGS) ;
   COMPILER_CFLAGS_optimize += $(MGFLAGS) ;
   COMPILER_CXXFLAGS_optimize += $(MGFLAGS) ;

}

CPPFLAGS                   += $(MGFLAGS) ;
COMPILER_CFLAGS            += -Wall -W -Wno-unused -Wno-sign-compare $(MGFLAGS) ;
COMPILER_CFLAGS_optimize   += -O3 -DNDEBUG $(MGFLAGS) ;
COMPILER_CXXFLAGS_optimize += -O3 -DNDEBUG $(MGFLAGS) ;
COMPILER_LIBS_optimize     += ;
COMPILER_CFLAGS_debug      += -DDEBUG -g3 ;
COMPILER_CXXFLAGS_debug    += -DDEBUG -g3 ;
COMPILER_LIBS_debug        += -g3 ;
COMPILER_CFLAGS_profile    += -O3 -fno-inline -pg ;
COMPILER_CXXFLAGS_profile  += -O3 -fno-inline -g3 -pg ;
COMPILER_LIBS_profile      += -pg ;

LINK = $(CXX) ;

# Include build rules
include $(TOP)/mk/jam/build.jam ;

# Include Dirs
IncludeDir $(top_builddir) ; # for config.h
